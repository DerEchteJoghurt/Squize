<!doctype html>
<html lang="en" data-bs-theme="dark">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/quiz_play.css">

    <script src="js/jquery.min.js"></script>
    <title>Squize - Editor</title>
  </head>

  <body>
    <div class="container py-3">
      <header>
        <div class="d-flex flex-column flex-md-row align-items-center p-3 mb-4 border-bottom">
          <a href="/"><img style="width: 40px;" src="./favicon.ico" alt=""></a>
          <a class="text-decoration-none link-body-emphasis" href="/"><h5 class="my-0 mr-md-auto font-weight-normal">Squize</h5></a>
          <a class="d-inline-flex mt-2 mt-md-0 ms-md-auto btn btn-outline-primary" href="/profile">Profile</a>
        </div>
      </header>

      <main>
        <div class="container py-5">
            <div class="h-100 d-flex align-items-center justify-content-center">
                <div>
                    <div class="bg-body-secondary rounded">
                        <div class="w-100 col-sm-10">
                          <input id="question" type="text" class="form-control-plaintext text-center display-6" value="Was ist die Hauptstadt von Deutschland?">
                        </div>
                        <div class="row row-cols-2 p-5">
                            <div class="col py-2">
                              <div class="d-flex align-items-center quiz_button h-100">
                                <div class="input-group h-100 m-5">
                                  <div class="input-group-text">
                                    <input class="form-check-input mt-0" name="correctRadios" type="radio" value="ol" aria-label="Correct">
                                  </div>
                                  <input id="ol" type="text" class="form-control" value="TÃ¼bingen" aria-label="Field value">     
                                </div>
                              </div>
                            </div>
                            <div class="col py-2">
                              <div class="d-flex align-items-center quiz_button h-100">
                                <div class="input-group h-100 m-5">
                                  <div class="input-group-text">
                                    <input class="form-check-input mt-0" name="correctRadios" type="radio" value="or" aria-label="Correct" checked>
                                  </div>
                                  <input id="or" type="text" class="form-control" value="Berlin" aria-label="Field value">     
                                </div>
                              </div>
                            </div>
                            <div class="col py-2">
                              <div class="d-flex align-items-center quiz_button h-100">
                                <div class="input-group h-100 m-5">
                                  <div class="input-group-text">
                                    <input class="form-check-input mt-0" name="correctRadios" type="radio" value="ul" aria-label="Correct">
                                  </div>
                                  <input id="ul" type="text" class="form-control" value="Albstadt" aria-label="Field value">     
                                </div>
                              </div>
                            </div>
                            <div class="col py-2">
                              <div class="d-flex align-items-center quiz_button h-100">
                                <div class="input-group h-100 m-5">
                                  <div class="input-group-text">
                                    <input class="form-check-input mt-0" name="correctRadios" type="radio" value="ur" aria-label="Correct">
                                  </div>
                                  <input id="ur" type="text" class="form-control" value="6394" aria-label="Field value">     
                                </div>
                              </div>
                            </div>
                        </div>
                    </div>
                    <div class="h-100 d-flex align-items-center justify-content-center py-2">
                      <button id="savebtn" class="btn btn-success mx-2" href="#">Save</button>
                      <button id="creatbtn" type="button" class="btn btn-primary mx-2" data-bs-toggle="modal" data-bs-target="#createNewModal">Create new</button>
                      <button id="nextbtn" class="btn btn-outline-primary mx-2" href="/quiz_edit2">Next</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Create New Modal -->
        <div class="modal fade" id="createNewModal" tabindex="-1" role="dialog" aria-labelledby="createNewModalTitle" aria-hidden="true">
          <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createNewModalTitle">Select Question Type</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <button type="button" class="btn btn-primary" onclick="location.href='/quiz_edit1';">Multiple Choice</button>
                  <button type="button" class="btn btn-primary" onclick="location.href='/quiz_edit2';">Text Input</button>
                </div>
              </div>
          </div>
        </div>
      </main>

      <footer class="my-5 pt-5 text-muted text-center text-small">
        <p class="mb-1">&copy; 2024 Squize Team</p>
        <ul class="list-inline">
          <li class="list-inline-item"><a href="/impressum">Impressum</a></li>
          <li class="list-inline-item"><a target="_blank" href="https://github.com/DerEchteJoghurt/Squize">GitHub</a></li>
        </ul>
      </footer>
    </div>

    <script type="module" src="js/main.js"></script>
    <script>
      function addQuestionToLocalStorage(questionobject) {
        var quiz = JSON.parse(localStorage.getItem("Quizheader"));
        if (!(quiz.hasOwnProperty("questions"))){
          quiz.question = {pos : 1, question : questionobject.question, answer : questionobject.answer,  qtype : "mult"};
        }
        else {
          quiz.question = {pos : ((quiz.questions.pos) + 1), question : questionobject.question, answer : questionobject.answer, qtype : "mult"};
          console.log("not")
        }
        localStorage.setItem("Quizheader", JSON.stringify(quiz));
      }
      $(document).ready(function() {
        $("#savebtn").on("click", () => {
          var correct = $("input[type='radio']:checked").val();
          var wrong = ["or","ol", "ur", "ul"];
          w = wrong.indexOf(correct);
          wrong.splice(w, 1);
          addQuestionToLocalStorage({question : $("#question").val(), answer : {
            correct : $('#' + correct.toString()).val(),
            wrong1 : $('#' + wrong[0].toString()).val(),
            wrong2 : $('#' + wrong[1].toString()).val(),
            wrong3 : $('#' + wrong[2].toString()).val()
          }})
          
          $.ajax({
            url: 'http://localhost:3000/api/quiz/add_question',
            method: 'POST',
            contentType: 'application/json; charset=utf-8',
            cache: false,
            dataType: 'json',
            data: localStorage.getItem("Quizheader")
          }).done(function (response) {
              console.dir(response);
              location.href = "/profile";
          }).fail(function (jqXHR, statusText, error) {
              console.dir(jqXHR.responseText);
              return;
          });
        })
        $("#createbtn").on("click", () => {
          var correct = $("input[type='radio']:checked").val();
          var wrong = ["or","ol", "ur", "ul"];
          w = wrong.indexOf(correct);
          wrong.splice(w, 1);
          addQuestionToLocalStorage({question : $("#question").val(), answer : {
            correct : $('#' + correct.toString()).val(),
            wrong1 : $('#' + wrong[0].toString()).val(),
            wrong2 : $('#' + wrong[1].toString()).val(),
            wrong3 : $('#' + wrong[2].toString()).val()
          }})
          
          $.ajax({
            url: 'http://localhost:3000/api/quiz/add_question',
            method: 'POST',
            contentType: 'application/json; charset=utf-8',
            cache: false,
            dataType: 'json',
            data: localStorage.getItem("Quizheader")
          }).done(function (response) {
              console.dir(response);
          }).fail(function (jqXHR, statusText, error) {
              console.dir(jqXHR.responseText);
              return;
        });
        })
        $("#nextbtn").on("click", () => {
          // TODO : next und prev. button
        })
      });
    </script>
  </body>
</html>
